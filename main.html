<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon"> <!-- Favicon-->
    <title>Ayssoft | Organization</title>
    <meta name="description" content="Ayssoft">
    <meta name="author" content="Ayssoft">

    <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/vendor/animate-css/vivify.min.css">

    <link rel="stylesheet" href="assets/css/site.min.css">

    <style>

        body {
            overflow: hidden;
        }

        /* width */
        ::-webkit-scrollbar {
            width: 5px;
            border-radius: 15px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #444444;
            border-radius: 15px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 15px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #222222;
            border-radius: 15px;
        }

        .chat-message {
            position: absolute;
            bottom: 2%;
            right: 10%;
            width: 70%;
        }

        .chat-history {
            float: left;
            overflow-x: hidden;
            overflow-y: auto;
            width: 100%;
            margin-bottom: 0;
            max-height: 82vh;
        }

        #dragBar {
            -webkit-user-select: none;
            -webkit-app-region: drag;
        }

        #dragBar a {
            -webkit-app-region: no-drag;
        }

        textarea {
            resize: none;
        }

    </style>
</head>

<body class="theme-blush font-montserrat">



<div class="overlay"></div>

<div id="wrapper">
    <div id="left-sidebar" class="sidebar">
        <div class="navbar-brand">
            <img src="assets/images/ayssoft.png" style="width: 30%; height: 26px; margin-left: 10px">
        </div>
        <div class="sidebar-scroll">
            <div class="user-account">
                <div class="user_div">
                    <img src="assets/images/user.png" class="user-photo" alt="User Profile Picture">
                </div>
                <div class="dropdown">
                    <span>Hoşgeldiniz,</span>
                    <a class="user-name"><strong>Talha Can</strong></a>
                </div>
            </div>
            <nav id="left-sidebar-nav" class="sidebar-nav">
                <ul id="main-menu" class="metismenu">
                    <li class="header">Sohbet Kanalları</li>
                    <li class=""><a href="#" data-id="1" class="groupChatTitle" style="font-size:13px; margin-left: 15px"><span>#Genel</span></a></li>
                    <li class=""><a href="#" data-id="2" class="groupChatTitle" style="font-size:13px; margin-left: 15px"><span>#I-Uyum</span></a></li>
                    <li class=""><a href="#" data-id="3" class="groupChatTitle" style="font-size:13px; margin-left: 15px"><span>#e-Fatura e-Arşiv</span></a></li>
                    <li class="header" style="margin-bottom: 20px">Direkt Mesaj</li>
                    <li class=""><a href="#" data-id="1" class="singleChatTitle" style="font-size:13px; margin-left: 5px; margin-top: -15px"><i class="fa fa-circle text-success"></i><span>Enes Karakuş</span></a></li>
                    <li class=""><a href="#" data-id="2" class="singleChatTitle" style="font-size:13px; margin-left: 5px; margin-top: -15px"><i class="fa fa-circle-o text-warning"></i><span>Furkan Haskoloğlu</span></a></li>
                    <li class=""><a href="#" data-id="3" class="singleChatTitle" style="font-size:13px; margin-left: 5px; margin-top: -15px"><i class="fa fa-circle text-danger"></i><span>Uğur Gök</span></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="container-fluid">
        <div class="chatapp_body" id="chatBody">
            <div class="chat-history" id="chatHistory">
                <ul class="message_data" id="messages">

                </ul>
            </div>
            <div class="chat-message clearfix">
                <div class="input-group mb-0">
                    <textarea id="message" class="form-control" rows="3" style="border-radius: 15px"></textarea>
                    <label for="message"></label>
                </div>
            </div>
        </div>
    </div>
</div>


<script>window.$ = window.jQuery = require('jquery');</script>
<!--<script>window.$ = window.jQuery = require('./jquery-3.0.0.min.js');</script>-->

<script src="assets/bundles/libscripts.bundle.js"></script>
<script src="assets/bundles/vendorscripts.bundle.js"></script>
<script src="assets/bundles/mainscripts.bundle.js"></script>

<script src="node_modules/socket.io/client-dist/socket.io.js"></script>

<script>
    var socket = io('http://localhost:3800');
    socket.on('connect', function(){});
    socket.on('event', function(data){});
    socket.on('disconnect', function(){});

    var chatHistorySelector = $('#chatHistory');

    socket.on('re-send-message', (message) => {
        var date = new Date()
        var time = date.getHours() + ":" + date.getMinutes()
        messagesSelector.append('' +
            '<li class="left clearfix">' +
            '    <img class="user_pix" src="assets/images/avatar.jpg" alt="avatar">' +
            '        <div class="message">' +
            '               <span>' + message + '</span>' +
            '           </div>' +
            '           <span class="data_time">' + time + '</span>' +
            '   </li>' +
            '')
        chatHistorySelector.scrollTop(chatHistorySelector[0].scrollHeight);
    })

    $('.groupChatTitle').click(function () {
        $("#chatBody").show();
    })

    var messagesSelector = $("#messages");

    $("#message").keydown(function (event) {
        if (event.keyCode === 13) {
            socket.emit('send-message', $(this).val())
        }
    }).keyup( function (event) {
        if (event.keyCode === 13) {
            $(this).val(null)
        }
    });

</script>

<script>
    var mysql      = require('mysql');
    var connection = mysql.createConnection({
        host     : 'localhost',
        user     : 'root',
        password : '',
        database : 'realtime'
    });

    connection.connect();

    connection.query("SELECT * from messages where deleted_at is null", function (error, messages, fields) {
        if (error) throw error;
        $.each(messages, function (message) {
            var date = new Date(messages[message].created_at);
            messagesSelector.append('' +
                '<li class="left clearfix">' +
                '    <img class="user_pix" src="assets/images/avatar.jpg" alt="avatar">' +
                '        <div class="message">' +
                '               <span>' + messages[message].message + '</span>' +
                '           </div>' +
                '           <span class="data_time">' + date.getHours() + ':' + date.getMinutes() + '</span>' +
                '   </li>' +
                '')
        });
    });

    connection.end();
</script>

</body>
</html>
